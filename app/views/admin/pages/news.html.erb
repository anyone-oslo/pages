<%
  month_names = %w{January February March April May June July August September October November December}
  page_title "News"
  page_description "<em>News: #{month_names[@month - 1] if @month} #{@year}</em>"

  if PagesCore.config.localizations?
    self.page_description_links = 'In ' + PagesCore.config.locales.map{ |l, n| link_to_unless_current n, news_admin_pages_path(l) }.join(link_separator)
  end
%>

<% content_for :sidebar do %>
  <h2>New article</h2>
  <p>
    <%= form_tag new_news_admin_pages_path, method: :get do %>
      In <%= select_tag 'parent', options_for_select(@news_pages.map{|p| [page_name(p, include_parents: true).gsub("&raquo;", "Â»"), p.id] }) %>
      <%= submit_tag "Go", name: nil %>
    <% end %>
  </p>
  <div class="archive-index">
    <% @archive_finder.years_with_count.reverse.each do |year, year_count| %>
      <h2>
        <%= link_to_unless_current(year,
                                   news_admin_pages_path(
                                     @locale,
                                     year: year,
                                     category: @category&.slug)
        ) %>
        <%= ": #{@category.name}" if @category %>
        <span class="count">
          (<%= year_count %>)
        </span>
      </h2>
      <ul>
        <% @archive_finder.months_in_year_with_count(year).reverse.each do |month, page_count| %>
          <li>
            <% if year == @year && month == @month %>
              <strong>
                <%= month_names[month-1] %>
              </strong>
              (<%= page_count %>)
            <% else %>
              <%= link_to(month_names[month-1],
                          news_admin_pages_path(@locale,
                                                month: month,
                                                year: year,
                                                category: @category&.slug)) %>
              <span class="count">
                (<%= page_count %>)
              </span>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
<% end %>

<% if @pages.any? %>
  <table class="list news-item-list">
    <tr>
      <th>Name</th>
      <th>Published</th>
      <th>Section</th>
      <th>Author</th>
    </tr>
    <% @pages.each do |page| %>
      <tr class="<%= [page.status_label.downcase,((page.autopublish?) ? 'autopublish' : nil), ((page.pinned?) ? 'pinned' : nil)].join(' ') %>">
        <td class="name">
          <%= link_to_if(policy(page).edit?,
                         page_name(page),
                         edit_admin_page_url(@locale, page),
                         class: 'name_link') %>
          <% if page.autopublish? %>
            <br />
            <small>
              This page will be published
              <strong><%= publish_time(page.published_at) %></strong>
            </small>
          <% end %>
        </td>
        <td>
          <% if page.published? %>
            <%= l(page.published_at, format: :short) %>
          <% else %>
            <% if page.status_label == 'Published' %>
              <em>Not published</em>
            <% else %>
              <em><%= page.status_label %></em>
            <% end %>
          <% end %>
        </td>
        <td>
          <%= page_name(page.parent, include_parents: true) %>
        </td>
        <td>
          <%= link_to page.author.name, admin_user_path(page.author) %>
        </td>
      </tr>
    <% end %>
  </table>

  <%= will_paginate @pages, renderer: PagesCore::LinkRenderer %>
<% else %>
  <div class="content">
    <p>
      No news items have been posted yet.
    </p>
  </div>
<% end %>

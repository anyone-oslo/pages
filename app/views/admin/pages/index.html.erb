<%
  page_title "Pages"
  page_description "Viewing pages"

  if PagesCore.config.localizations?
    page_description_links 'In ' + PagesCore.config.locales.map{ |l, n| link_to_unless_current n, admin_pages_path(l) }.join(link_separator)
  end
%>

<% content_for :sidebar do %>
  <% if policy(Page).new? %>
    <h2>New page</h2>
    <p>
      <%= form_tag new_admin_page_path, method: :get do %>
        In <%= select_tag 'parent', options_from_collection_for_select(@root_pages, 'id', 'name') %>
        <%= submit_tag "Go", name: nil %>
      <% end %>
    </p>
    <p>
      You can also <%= link_to "create a new root page", new_admin_page_path(@locale) %>.
    </p>
    <h2>Structure</h2>
    <p>
      <button id="reorder_link" type="button">Reorder the pages</button>
    </p>
    <!-- What shall with do with a drunken sailor?
    <h2>Categories</h2>
    <% if @categories && @categories.length > 0 %>
      <ul>
        <% @categories.each do |category| %>
          <li><%= category.name %> (<%= link_to "Delete", admin_category_path(category), method: :delete, class: :delete, data: {confirm: "Are you sure? There is no undo."} %>)</li>
        <% end %>
      </ul>
    <% end %>
    <div id="new-category">
      <%= form_for([:admin, Category.new]) do |f| %>
        <p>
          <label><strong>New category</strong></label>
          <%= f.text_field :name %>
          <%= submit_tag "Save" %>
        </p>
      <% end %>
    </div>
    <div id="new-category-button">
      <p>
        <button type="button" class="toggle-category">
          Add a new category
        </button>
      </p>
    </div>
    -->
  <% else %>
    &nbsp;
  <% end %>
<% end %>

<div class="content">
  <% if @root_pages.length < 1 -%>
    <p>No pages found</p>
  <% else -%>
    <ul class="pagelist reorderable">
      <% @root_pages.each do |page| -%>
        <%= render partial: "pagelisting", locals: { page: page } %>
      <% end -%>
    </ul>
  <% end -%>
</div>

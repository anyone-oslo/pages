<%
  if page.news_page?
    subpages = []
  else
    subpages = page.children.visible.in_locale(page.locale).order(page.content_order)
  end
  page_classes = ['page', 'page_listing']
  page_classes << 'hidden' unless page.published?
  page_classes << 'page_without_locale' unless page.name?
-%>
<li page_id="<%= page.id %>">
  <% if page.reorderable? %>
    <div class="drag_handle">
    </div>
  <% end %>
  <div class="<%= page_classes.join(' ') %>" id="pagelisting_<%= page.id %>">
    <% if page.published? %>
      <%= link_to(page_name(page), edit_admin_page_url(@locale, page), :class => 'page_name') %>
    <% else %>
      <%= link_to(page_name(page), edit_admin_page_url(@locale, page), :class => 'page_name') %>
      <small class="status">
        (<%= (page.autopublish?) ? "Will publish at "+page.published_at.to_formatted_s(:short)  : page.status_label %><% if page.draft? && page.author %> by <%= page.author.realname %><% end %>)
      </small>
    <% end %>

    <%# Feed icon %>
    <% if page.feed_enabled? %>
      <%= image_tag("pages/feed-icon-14x14.png", :size => "10x10") %>
    <% end %>

    <div class="actions">
      &mdash;
      <%= link_to "Edit", edit_admin_page_url(@locale, page) %> /
      <%= link_to "Create subpage", new_admin_page_url(@locale, parent: page ) %>
      &mdash;
      <small>last updated <%= time_ago_in_words page.updated_at %> ago</small>
    </div>
  </div>
  <% if page.news_page? %>
    <ul>
      <li><div class="page_listing">
        <em>(<%= page.children.visible.count %> items)</em>
        <div class="actions">
          &mdash;
          <%= link_to "Create new", new_news_admin_pages_url(@locale, parent: page) %>
        </div>
      </div></li>
    </ul>
  <% elsif subpages.length > 0 %>
    <ul <%= 'class="reorderable"'.html_safe if page.reorderable_children? %> parent_page_id="<%= page.id %>"><% subpages.each do |subpage| %>
      <%= render :partial => "pagelisting", :locals => { :page => subpage } %>
    <% end %></ul>
  <% else %>
    <ul></ul>
  <% end %>
</li>

<%
	page_title       "Sign in"
	page_description "Please enter your username and password to sign in"
	add_body_class   "login"
-%>

<% sidebar do -%>
	<h2>Please note</h2>
	<p>
		Microsoft Internet Explorer is currently not supported. We recommend using <strong>Safari</strong> or 
		<a href="http://www.mozilla.com/" target="_blank"><strong>Firefox</strong></a>, a free, fast and secure alternative.
	</p>
	<p>
		<a href="http://getfirefox.com/"
		title="Get Firefox - The Browser, Reloaded."><img
		src="http://www.mozilla.org/products/firefox/buttons/firefox_80x15.png"
		width="80" height="15" border="0" alt="Get Firefox"></a>
	</p>
	<p>
		Please make sure Javascript and cookies are enabled if you experience problems logging in or using Pages.
	</p>
<% end -%>

<div id="forgotPasswordForm">
	<% form_tag({:controller => :users, :action => :new_password}) do %>
		<h2>Forgot your password?</h2>
		<p>
			Don't worry, it happens. Enter your <strong>username</strong> or <strong>email address</strong> below, and we'll email you a new password.
		</p>
		<p>
			<%= text_field_tag :username, '', :size => 48 %>
			<button type="submit">Send</button>
		</p>
	<% end %>
</div>

<div id="loginForm">

	<% form_tag login_admin_users_path, :id => 'loginRegular' do %>
		<p>
			<label>Username</label>
			<%= text_field_tag :login_username %>
		</p>
		<p>
			<label>Password</label>
			<%= password_field_tag :login_password %>
		</p>
		<p>
			<button type="submit">Sign in</button>
		</p>
		<ul class="login_links">
			<li><%= link_to_function "<strong>Help!</strong> I forgot my password!", "forgot_password();" %></li>
			<li><%= link_to_function "Sign in with OpenID", "toggleLoginMode();" %></li>
		</ul>
	<% end %>

	<% form_tag openid_path, :id => 'loginOpenID' do %>
		<%= hidden_field_tag :openid_success, admin_default_url %>
		<%= hidden_field_tag :openid_fail, admin_default_url %>
		<p>
			<label>Enter your OpenID URL:</label>
			<%= text_field_tag :openid_url, '', :class => 'openid_url' %>
		</p>
		<p>
			<button type="submit">Sign in</button>
		</p>
		<ul class="login_links">
			<li><%= link_to "What is OpenID?", "http://openid.net/" %></li>
			<li><%= link_to_function "Sign in with with username and password", "toggleLoginMode();" %></li>
		</ul>
	<% end %>


</div>


<script type="text/javascript">
	(function($){
		
		window.toggleLoginMode = function(){
			if ($.cookie('login_mode') === 'openid') {
				$('#loginOpenID').hide();
				$('#loginRegular').show();
				$.cookie('login_mode', 'regular');
			} else {
				$('#loginOpenID').show();
				$('#loginRegular').hide();
				$.cookie('login_mode', 'openid');
			}
		}
		
		if ($.cookie('login_mode') === 'openid') {
			$('#loginRegular').hide();
		} else {
			$('#loginOpenID').hide();
		}

		$('#forgotPasswordForm').hide();

		window.forgot_password = function() {
			$('#forgotPasswordForm').show();
			$('#loginForm').hide();
			return false;
		}
	})(jQuery);
</script>
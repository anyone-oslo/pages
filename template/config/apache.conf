<VirtualHost *:80>
	ServerName <%= @site_domain %>
	ServerAlias www.<%= @site_domain %> <%= @app_name %>.0102.no
	ServerAdmin support@manualdesign.no 
	RailsBaseURI /
	ErrorLog /var/log/apache2/<%= @site_domain %>-error.log
	LogLevel warn
	CustomLog /var/log/apache2/<%= @site_domain %>-access.log combined
	ServerSignature Off

	DocumentRoot /var/www/<%= @app_name %>/current/public
	<Directory "/var/www/<%= @app_name %>/current/public">
		Options FollowSymLinks
		AllowOverride None
		Order allow,deny
		Allow from all
		AddType 'application/rss+xml;charset=UTF-8' rss rss;schedule
	</Directory>

	AddDefaultCharset UTF-8

	RewriteEngine On

	# Check for maintenance file and redirect all requests
	#  ( this is for use with Capistrano's disable_web task )
	RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
	RewriteCond %{SCRIPT_FILENAME} !maintenance.html
	RewriteRule ^.*$ /system/maintenance.html [L]

	# Rewrite index to check for static
	RewriteRule ^/$ /index.html [QSA] 

	# Rewrite to check for Rails cached page
	RewriteRule ^([^.]+)$ $1.html [QSA]

	# Page cache
	RewriteCond %{DOCUMENT_ROOT}/cache/%{REQUEST_FILENAME} -f
	RewriteRule ^/(.*)$ /cache/$1 [PT]

	# Redirect all non-static requests to cluster
	#RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
	#RewriteCond %{DOCUMENT_ROOT}/cache/%{REQUEST_FILENAME} -f
	#RewriteRule ^/(.*)$ balancer://<%= @app_name %>_cluster%{REQUEST_URI} [P,QSA,L]
</VirtualHost>
